<!doctype html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ajouter un Blog</title>
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <!-- Header Start -->
    <div class="header-area">
        <div class="main-header ">
            <div class="header-top black-bg d-none d-sm-block">
                <div class="container">
                    <div class="col-xl-12">
                        <div class="row d-flex justify-content-between align-items-center">
                            <div class="header-info-left">
                                <ul>     
                                    <li class="title"><span class="flaticon-energy"></span> Actualités en temps réel</li>
                                    <li>Agrégateur de nouvelles internationales</li>
                                </ul>
                            </div>
                            <div class="header-info-right">
                                <ul class="header-date">
                                    <li><span class="flaticon-calendar"></span> <span id="current-date"></span></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="header-mid gray-bg">
                <div class="container">
                    <div class="row d-flex align-items-center">
                        <!-- Logo -->
                        <div class="col-xl-3 col-lg-3 col-md-3 d-none d-md-block">
                            <div class="logo">
                                <a href="index.html"><img src="assets/img/logo/logo.png" alt=""></a>
                            </div>
                        </div>
                        <div class="col-xl-9 col-lg-9 col-md-9">
                            <div class="header-banner f-right ">
                                <img src="assets/img/gallery/header_card.png" alt="">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="header-bottom header-sticky">
                <div class="container">
                    <div class="row align-items-center">
                        <div class="col-xl-8 col-lg-8 col-md-12 header-flex">
                            <!-- sticky -->
                            <div class="sticky-logo">
                                <a href="index.html"><img src="assets/img/logo/logo.png" alt=""></a>
                            </div>
                            <!-- Main-menu -->
                            <div class="main-menu d-none d-md-block">
                                <nav>                  
                                    <ul id="navigation">
                                        <li><a href="index.html">Home</a></li>
                                        <li><a href="about.html">about</a></li>
                                        <li><a href="#">Pages</a>
                                            <ul class="submenu">
                                                <li><a href="blog.html">Blog</a></li>
                                                <li><a href="blog_details.html">Blog Details</a></li>
                                            </ul>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        </div>             
                        <!-- Mobile Menu -->
                        <div class="col-12">
                            <div class="mobile_menu d-block d-md-none"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Header End -->
    <div class="container mt-5">
        <div id="random-blog-detail" class="mb-4"></div>
        <h2>Ajouter un nouvel article de blog</h2>
        <form id="add-blog-form">
            <div class="form-group">
                <label for="title">Titre</label>
                <input type="text" class="form-control" id="title" required>
            </div>
            <div class="form-group">
                <label for="excerpt">Extrait</label>
                <textarea class="form-control" id="excerpt" rows="2" required></textarea>
            </div>
            <div class="form-group">
                <label for="content">Contenu</label>
                <textarea class="form-control" id="content" rows="5" required></textarea>
            </div>
            <div class="form-group">
                <label for="image">URL de l'image</label>
                <input type="url" class="form-control" id="image" required>
            </div>
            <div class="form-group">
                <label for="category">Catégorie</label>
                <input type="text" class="form-control" id="category" required>
            </div>
            <div class="form-group">
                <label for="author">Auteur</label>
                <input type="text" class="form-control" id="author" required>
            </div>
            <div class="form-group">
                <label for="publish_date">Date de publication</label>
                <input type="date" class="form-control" id="publish_date" required>
            </div>
            <div class="form-group">
                <label for="read_time">Temps de lecture</label>
                <input type="text" class="form-control" id="read_time" required>
            </div>
            <div class="form-group">
                <label for="tags">Tags (séparés par des virgules)</label>
                <input type="text" class="form-control" id="tags">
            </div>
            <button type="submit" class="btn btn-primary">Ajouter</button>
        </form>
        <div id="result-message" class="mt-3"></div>
    </div>
    <script>
        // Affichage d'un blog aléatoire
        async function showRandomBlogDetail() {
            try {
                const response = await fetch('/blog/posts?limit=1000');
                const data = await response.json();
                const posts = data.posts;
                if (!posts || posts.length === 0) return;
                const random = posts[Math.floor(Math.random() * posts.length)];
                document.getElementById('random-blog-detail').innerHTML = `
                    <div class="card">
                        <div class="row no-gutters">
                            <div class="col-md-4">
                                <img src="${random.image}" class="card-img" alt="${random.title}" style="object-fit:cover;height:100%" onerror="this.src='assets/img/blog/single_blog_1.png'">
                            </div>
                            <div class="col-md-8">
                                <div class="card-body">
                                    <h5 class="card-title">${random.title}</h5>
                                    <p class="card-text">${random.excerpt}</p>
                                    <p class="card-text"><small class="text-muted">Par ${random.author} le ${random.publish_date}</small></p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } catch {}
        }
        showRandomBlogDetail();

        document.getElementById('add-blog-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            const title = document.getElementById('title').value.trim();
            const excerpt = document.getElementById('excerpt').value.trim();
            const content = document.getElementById('content').value.trim();
            const image = document.getElementById('image').value.trim();
            const category = document.getElementById('category').value.trim();
            const author = document.getElementById('author').value.trim();
            const publish_date = document.getElementById('publish_date').value;
            const read_time = document.getElementById('read_time').value.trim();
            const tags = document.getElementById('tags').value.split(',').map(t => t.trim()).filter(Boolean);

            let newBlog = {
                id: Math.floor(Math.random() * 1e9),
                title,
                excerpt,
                content,
                image,
                category,
                author,
                publish_date,
                read_time,
                comments_count: 0,
                views_count: 0,
                tags
            };

            // Envoi réel au backend
            try {
                const response = await fetch('/blog/add', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newBlog)
                });
                if (!response.ok) throw new Error('Erreur serveur');
                const data = await response.json();
                document.getElementById('result-message').innerHTML =
                    '<div class="alert alert-success">Article ajouté avec succès !</div>';
                this.reset();
            } catch (err) {
                document.getElementById('result-message').innerHTML =
                    '<div class="alert alert-danger">Erreur lors de l\'ajout.</div>';
            }
        });
    </script>
</body>
</html>
